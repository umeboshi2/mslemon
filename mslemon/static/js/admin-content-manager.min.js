(function(){var b={}.hasOwnProperty,c=function(g,e){for(var d in e){if(b.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f();g.__super__=e.prototype;return g},a=function(d,e){return function(){return d.apply(e,arguments)}};jQuery(function(){var A,P,u,D,v,O,E,d,f,h,C,n,H,e,y,p,t,F,x,B,z,q,w,G,s,R,Q,N,M,L,K,J,I,r,o,m,l,k,j,i,g;q=TrumpetApp.make_alert;B=function(T,S){return q("Succesful Transfer","success")};x=function(T,S){return q("Error in Transfer","error")};z=function(){return{path:e,tmpl:F,css:E,js:h}};w=function(W,V,T){var S,U;if(T==null){T=""}S=ace.edit("editor");U=S.getSession();U.setValue(T);U.on("change",function(){return V.show()});if(W==="tmpl"){U.setMode("ace/mode/ejs")}else{if(W==="css"){U.setMode("ace/mode/css")}else{if(W==="js"){U.setMode("ace/mode/coffee")}}}S.setTheme("ace/theme/twilight");return S};u=(function(T){c(S,T);function S(){G=S.__super__.constructor.apply(this,arguments);return G}S.prototype.routes={"":"home","view/:listview":"listview"};S.prototype.common=function(){side_view.render();if(side_view.current_view!==null){return side_view.current_view.remove()}};S.prototype.home=function(){return this.common()};S.prototype.listview=function(V){var U,W;this.common();U=z()[V];W=new U;W.render({type:V});return side_view.current_view=W};return S})(Backbone.Router);C=(function(T){c(S,T);function S(){s=S.__super__.constructor.apply(this,arguments);return s}S.prototype.defaults={name:"",type:"path"};return S})(Backbone.Model);p=(function(S){c(T,S);function T(){r=T.__super__.constructor.apply(this,arguments);return r}T.prototype.defaults={name:"",content:"",type:"tmpl"};return T})(Backbone.Model);v=(function(S){c(T,S);function T(){o=T.__super__.constructor.apply(this,arguments);return o}T.prototype.defaults={name:"",content:"",type:"css"};return T})(Backbone.Model);d=(function(T){c(S,T);function S(){m=S.__super__.constructor.apply(this,arguments);return m}S.prototype.defaults={name:"",content:"",type:"js"};return S})(Backbone.Model);H=(function(T){c(S,T);function S(){l=S.__super__.constructor.apply(this,arguments);return l}S.prototype.model=C;S.prototype.url="/rest/sitepath";S.prototype.parse=function(U){return U.data};return S})(Backbone.Collection);t=(function(S){c(T,S);function T(){k=T.__super__.constructor.apply(this,arguments);return k}T.prototype.model=p;T.prototype.url="/rest/sitetmpl";T.prototype.parse=function(U){return U.data};return T})(Backbone.Collection);O=(function(S){c(T,S);function T(){j=T.__super__.constructor.apply(this,arguments);return j}T.prototype.model=v;T.prototype.url="/rest/sitecss";T.prototype.parse=function(U){return U.data};return T})(Backbone.Collection);f=(function(T){c(S,T);function S(){i=S.__super__.constructor.apply(this,arguments);return i}S.prototype.model=d;S.prototype.url="/rest/sitejs";S.prototype.parse=function(U){return U.data};return S})(Backbone.Collection);P=(function(S){c(T,S);function T(){g=T.__super__.constructor.apply(this,arguments);return g}T.prototype.template=TrumpetApp.admin_mgr_tmpl.entry;T.prototype.initialize=function(){_.bindAll(this,"render");this.model.bind("change",this.render);return this.model.bind("remove",this.unrender)};T.prototype.render=function(){var U;U=this.template(this.model.attributes);this.$el.html(U);return this};T.prototype.unrender=function(){console.log("unrender "+this.model.attributes);return $(this.el).remove()};T.prototype.events={"click .show-entry-btn":"editme"};T.prototype.editme=function(){var Y,ag,ac,ae,aa,ad,ab,V,X,ah,W,U,af,Z=this;af=TrumpetApp.admin_mgr_tmpl.editor;X=af(this.model.attributes);V=$(".listview-list");V.html(X);W=this.model.get("type");if(W==="path"){V.html("SHOW ME");return this}Y=$("#save-content");ac=this.model.get("content");ab=w(W,Y,ac);Y.hide();Y.click(function(){var ai;Z.model.set("content",ab.getValue());ai=Z.model.save();ai.done(function(){q("Saved");return $("#save-content").hide()});return ai.fail(function(){return q("Failed to save model")})});U=$("#new-entry-button");U.remove();aa='<div class="pull-right action-button del-entry-btn" id="del-entry-button">Delete</div>';ah=$(".listview-header");ah.append(aa);ag='<div id="confirm-delete"><span class="ui-icon ui-icon-alert"></span>Delete this object?</div>';$(".sidebar").append(ag);ae=$("#del-entry-button");ad=function(){var ai;ai=Z.model.destroy();ai.done(function(){var ak,aj;q("Deleted "+name);ak={trigger:true,replace:true};aj="view/"+W;main_router.navigate("dummy",ak);return main_router.navigate(aj,ak)});return ai.fail(function(){return q("Failed to delete "+name)})};ae.click(function(){var ai;$("#editor").hide();V=$("#confirm-delete");V.dialog({dialogClass:"no-close",modal:true,buttons:{"delete":function(){$(this).dialog("close");return ad()},cancel:function(){$(this).dialog("close");return $("#editor").show()}}});return ai=Z.model.get("name")});return this};return T})(Backbone.View);A=(function(T){c(S,T);function S(){this.appendItem=a(this.appendItem,this);R=S.__super__.constructor.apply(this,arguments);return R}S.prototype.el=$(".right-column-content");S.prototype.render=function(V){var U;U=TrumpetApp.admin_mgr_tmpl.listview;this.$el.html(U(V));return this};S.prototype.remove=function(){this.undelegateEvents();this.$el.empty();this.stopListening();return this};S.prototype.appendItem=function(V){var W,U;U=new P({model:V});W=U.render(V).el;return $(".listview-list").append(W)};S.prototype.events={"click .add-entry-btn":"new_entry_view"};S.prototype.new_entry_view=function(){var X,Y,W,ab,V,aa,U,Z=this;ab=this.collection.model;V=new ab();U=TrumpetApp.admin_mgr_tmpl.create;W=U(V.attributes);$(".listview-list").html(W);aa=V.get("type");X=$("#create-content");Y=w(aa,X,"");X.hide();X.click(function(){var ad,ac;V.set("content",Y.getValue());ad=$("#nameinput").val();V.set("name",ad);Z.collection.add(V);ac=V.save();ac.done(function(){var ae;ae="Created "+ad;return q(ae)});return ac.fail(function(){var ae;ae="Failed to create "+ad;return q(ae)})});return this};return S})(Backbone.View);e=(function(T){c(S,T);function S(){Q=S.__super__.constructor.apply(this,arguments);return Q}S.prototype.initialize=function(){console.log("Init SitePathListView");this.collection=new H;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return S})(A);F=(function(T){c(S,T);function S(){N=S.__super__.constructor.apply(this,arguments);return N}S.prototype.initialize=function(){console.log("Init SiteTemplateListView");this.collection=new t;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return S})(A);E=(function(T){c(S,T);function S(){M=S.__super__.constructor.apply(this,arguments);return M}S.prototype.initialize=function(){console.log("Init SiteCSSListView");this.collection=new O;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return S})(A);h=(function(T){c(S,T);function S(){L=S.__super__.constructor.apply(this,arguments);return L}S.prototype.initialize=function(){console.log("Init SiteJSListView");this.collection=new f;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return S})(A);y=(function(T){c(S,T);function S(){K=S.__super__.constructor.apply(this,arguments);return K}return S})(Backbone.View);n=(function(T){c(S,T);function S(){J=S.__super__.constructor.apply(this,arguments);return J}return S})(Backbone.View);D=(function(T){var U;c(S,T);function S(){I=S.__super__.constructor.apply(this,arguments);return I}S.prototype.el=$(".sidebar");S.prototype.initialize=function(){console.log("Init SideView");return this.current_view=null};S.prototype.template=TrumpetApp.admin_mgr_tmpl.side_view;S.prototype.render=function(){$(this.el).html(this.template());return this};U={trigger:true,replace:true};S.prototype.events={"click .home-button":function(){return main_router.navigate("",U)},"click .sitepaths-button":function(){$(".listview-list").remove();main_router.navigate("dummy",U);return main_router.navigate("view/path",U)},"click .sitetmpl-button":function(){$(".listview-list").remove();main_router.navigate("dummy",U);return main_router.navigate("view/tmpl",U)},"click .sitecss-button":function(){$(".listview-list").remove();main_router.navigate("dummy",U);return main_router.navigate("view/css",U)},"click .sitejs-button":function(){$(".listview-list").remove();main_router.navigate("dummy",U);return main_router.navigate("view/js",U)}};return S})(Backbone.View);window.main_router=new u;window.side_view=new D;return Backbone.history.start()})}).call(this);