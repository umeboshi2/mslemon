(function(){var b={}.hasOwnProperty,c=function(g,e){for(var d in e){if(b.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f();g.__super__=e.prototype;return g},a=function(d,e){return function(){return d.apply(e,arguments)}};jQuery(function(){var y,L,t,B,u,K,C,d,f,h,A,F,e,o,s,D,w,z,x,p,v,E,r,N,M,J,I,H,G,q,n,m,l,k,j,i,g;p=TrumpetApp.make_alert;z=function(P,O){return p("Succesful Transfer","success")};w=function(P,O){return p("Error in Transfer","error")};x=function(){return{path:e,tmpl:D,css:C,js:h}};v=function(S,R,P){var O,Q;if(P==null){P=""}O=ace.edit("editor");Q=O.getSession();Q.setValue(P);Q.on("change",function(){return R.show()});if(S==="tmpl"){Q.setMode("ace/mode/ejs")}else{if(S==="css"){Q.setMode("ace/mode/css")}else{if(S==="js"){Q.setMode("ace/mode/javascript")}}}O.setTheme("ace/theme/twilight");return O};t=(function(P){c(O,P);function O(){E=O.__super__.constructor.apply(this,arguments);return E}O.prototype.routes={"":"home","view/:listview":"listview"};O.prototype.common=function(){side_view.render();if(side_view.current_view!==null){return side_view.current_view.remove()}};O.prototype.home=function(){return this.common()};O.prototype.listview=function(R){var Q,S;this.common();Q=x()[R];S=new Q;S.render({type:R});return side_view.current_view=S};return O})(Backbone.Router);A=(function(P){c(O,P);function O(){r=O.__super__.constructor.apply(this,arguments);return r}O.prototype.defaults={name:"",type:"path"};return O})(Backbone.Model);o=(function(O){c(P,O);function P(){q=P.__super__.constructor.apply(this,arguments);return q}P.prototype.defaults={name:"",content:"",type:"tmpl"};return P})(Backbone.Model);u=(function(O){c(P,O);function P(){n=P.__super__.constructor.apply(this,arguments);return n}P.prototype.defaults={name:"",content:"",type:"css"};return P})(Backbone.Model);d=(function(P){c(O,P);function O(){m=O.__super__.constructor.apply(this,arguments);return m}O.prototype.defaults={name:"",content:"",type:"js"};return O})(Backbone.Model);F=(function(P){c(O,P);function O(){l=O.__super__.constructor.apply(this,arguments);return l}O.prototype.model=A;O.prototype.url="/rest/sitepath";O.prototype.parse=function(Q){return Q.data};return O})(Backbone.Collection);s=(function(O){c(P,O);function P(){k=P.__super__.constructor.apply(this,arguments);return k}P.prototype.model=o;P.prototype.url="/rest/sitetmpl";P.prototype.parse=function(Q){return Q.data};return P})(Backbone.Collection);K=(function(O){c(P,O);function P(){j=P.__super__.constructor.apply(this,arguments);return j}P.prototype.model=u;P.prototype.url="/rest/sitecss";P.prototype.parse=function(Q){return Q.data};return P})(Backbone.Collection);f=(function(P){c(O,P);function O(){i=O.__super__.constructor.apply(this,arguments);return i}O.prototype.model=d;O.prototype.url="/rest/sitejs";O.prototype.parse=function(Q){return Q.data};return O})(Backbone.Collection);L=(function(O){c(P,O);function P(){g=P.__super__.constructor.apply(this,arguments);return g}P.prototype.template=TrumpetApp.admin_mgr_tmpl.entry_template;P.prototype.initialize=function(){_.bindAll(this,"render");this.model.bind("change",this.render);return this.model.bind("remove",this.unrender)};P.prototype.render=function(){var Q;Q=this.template.render(this.model.attributes);this.$el.html(Q);return this};P.prototype.unrender=function(){return $(this.el).remove()};P.prototype.events={"click .show-entry-btn":"editme"};P.prototype.editme=function(){var U,ac,Y,aa,W,Z,X,R,T,ad,S,Q,ab,V=this;ab=TrumpetApp.admin_mgr_tmpl.editor_template;T=ab.render(this.model.attributes);R=$(".listview-list");R.html(T);S=this.model.get("type");if(S==="path"){R.html("SHOW ME");return this}U=$("#save-content");Y=this.model.get("content");X=v(S,U,Y);U.hide();U.click(function(){var ae;V.model.set("content",X.getValue());ae=V.model.save();ae.done(function(){p("Saved");return $("#save-content").hide()});return ae.fail(function(){return p("Failed to save model")})});Q=$("#new-entry-button");Q.remove();W='<div class="pull-right action-button del-entry-btn" id="del-entry-button">Delete</div>';ad=$(".listview-header");ad.append(W);ac='<div id="confirm-delete"><span class="ui-icon ui-icon-alert"></span>Delete this object?</div>';$(".sidebar").append(ac);aa=$("#del-entry-button");Z=function(){var ae;ae=V.model.destroy();ae.done(function(){var ag,af;p("Deleted "+name);ag={trigger:true,replace:true};af="view/"+S;main_router.navigate("dummy",ag);return main_router.navigate(af,ag)});return ae.fail(function(){return p("Failed to delete "+name)})};aa.click(function(){var ae;$("#editor").hide();R=$("#confirm-delete");R.dialog({dialogClass:"no-close",modal:true,buttons:{"delete":function(){$(this).dialog("close");return Z()},cancel:function(){$(this).dialog("close");return $("#editor").show()}}});return ae=V.model.get("name")});return this};return P})(Backbone.View);y=(function(P){c(O,P);function O(){this.appendItem=a(this.appendItem,this);N=O.__super__.constructor.apply(this,arguments);return N}O.prototype.el=$(".right-column-content");O.prototype.render=function(R){var Q;Q=TrumpetApp.admin_mgr_tmpl.listview_template;this.$el.html(Q.render(R));return this};O.prototype.remove=function(){this.undelegateEvents();this.$el.empty();this.stopListening();return this};O.prototype.appendItem=function(R){var S,Q;Q=new L({model:R});S=Q.render(R).el;return $(".listview-list").append(S)};O.prototype.events={"click .add-entry-btn":"new_entry_view"};O.prototype.new_entry_view=function(){var T,U,S,X,R,W,Q,V=this;X=this.collection.model;R=new X();Q=TrumpetApp.admin_mgr_tmpl.create_template;S=Q.render(R.attributes);$(".listview-list").html(S);W=R.get("type");T=$("#create-content");U=v(W,T,"");T.hide();T.click(function(){var Z,Y;R.set("content",U.getValue());Z=$("#nameinput").val();R.set("name",Z);V.collection.add(R);Y=R.save();Y.done(function(){var aa;aa="Created "+Z;return p(aa)});return Y.fail(function(){var aa;aa="Failed to create "+Z;return p(aa)})});return this};return O})(Backbone.View);e=(function(P){c(O,P);function O(){M=O.__super__.constructor.apply(this,arguments);return M}O.prototype.initialize=function(){console.log("Init SitePathListView");this.collection=new F;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return O})(y);D=(function(P){c(O,P);function O(){J=O.__super__.constructor.apply(this,arguments);return J}O.prototype.initialize=function(){console.log("Init SiteTemplateListView");this.collection=new s;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return O})(y);C=(function(P){c(O,P);function O(){I=O.__super__.constructor.apply(this,arguments);return I}O.prototype.initialize=function(){console.log("Init SiteCSSListView");this.collection=new K;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return O})(y);h=(function(P){c(O,P);function O(){H=O.__super__.constructor.apply(this,arguments);return H}O.prototype.initialize=function(){console.log("Init SiteJSListView");this.collection=new f;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return O})(y);B=(function(P){var Q;c(O,P);function O(){G=O.__super__.constructor.apply(this,arguments);return G}O.prototype.el=$(".sidebar");O.prototype.initialize=function(){console.log("Init SideView");return this.current_view=null};O.prototype.template=TrumpetApp.admin_mgr_tmpl.side_view_template;O.prototype.render=function(){$(this.el).html(this.template.render());return this};Q={trigger:true,replace:true};O.prototype.events={"click .home-button":function(){return main_router.navigate("",Q)},"click .sitepaths-button":function(){$(".listview-list").remove();main_router.navigate("dummy",Q);return main_router.navigate("view/path",Q)},"click .sitetmpl-button":function(){$(".listview-list").remove();main_router.navigate("dummy",Q);return main_router.navigate("view/tmpl",Q)},"click .sitecss-button":function(){$(".listview-list").remove();main_router.navigate("dummy",Q);return main_router.navigate("view/css",Q)},"click .sitejs-button":function(){$(".listview-list").remove();main_router.navigate("dummy",Q);return main_router.navigate("view/js",Q)}};return O})(Backbone.View);window.main_router=new t;window.side_view=new B;return Backbone.history.start()})}).call(this);