(function(){var b={}.hasOwnProperty,c=function(g,e){for(var d in e){if(b.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f();g.__super__=e.prototype;return g},a=function(d,e){return function(){return d.apply(e,arguments)}};jQuery(function(){var x,K,s,A,t,J,B,d,f,h,z,E,e,o,r,C,v,y,w,u,D,q,M,L,I,H,G,F,p,n,m,l,k,j,i,g;y=function(O,N){return make_alert("Succesful Transfer","success")};v=function(O,N){return make_alert("Error in Transfer","error")};w=function(){return{path:e,tmpl:C,css:B,js:h}};window.lviews=w;u=function(R,Q,O){var N,P;if(O==null){O=""}N=ace.edit("editor");P=N.getSession();P.setValue(O);P.on("change",function(){return Q.show()});if(R==="tmpl"){P.setMode("ace/mode/ejs")}else{if(R==="css"){P.setMode("ace/mode/css")}else{if(R==="js"){P.setMode("ace/mode/javascript")}}}N.setTheme("ace/theme/twilight");return N};s=(function(O){c(N,O);function N(){D=N.__super__.constructor.apply(this,arguments);return D}N.prototype.routes={"":"home","view/:listview":"listview"};N.prototype.common=function(){side_view.render();if(side_view.current_view!==null){return side_view.current_view.remove()}};N.prototype.home=function(){return this.common()};N.prototype.listview=function(Q){var P,R;this.common();P=w()[Q];R=new P;R.render({type:Q});return side_view.current_view=R};return N})(Backbone.Router);z=(function(O){c(N,O);function N(){q=N.__super__.constructor.apply(this,arguments);return q}N.prototype.defaults={name:"",type:"path"};return N})(Backbone.Model);o=(function(N){c(O,N);function O(){p=O.__super__.constructor.apply(this,arguments);return p}O.prototype.defaults={name:"",content:"",type:"tmpl"};return O})(Backbone.Model);t=(function(N){c(O,N);function O(){n=O.__super__.constructor.apply(this,arguments);return n}O.prototype.defaults={name:"",content:"",type:"css"};return O})(Backbone.Model);d=(function(O){c(N,O);function N(){m=N.__super__.constructor.apply(this,arguments);return m}N.prototype.defaults={name:"",content:"",type:"js"};return N})(Backbone.Model);E=(function(O){c(N,O);function N(){l=N.__super__.constructor.apply(this,arguments);return l}N.prototype.model=z;N.prototype.url="/rest/sitepath";N.prototype.parse=function(P){return P.data};return N})(Backbone.Collection);r=(function(N){c(O,N);function O(){k=O.__super__.constructor.apply(this,arguments);return k}O.prototype.model=o;O.prototype.url="/rest/sitetmpl";O.prototype.parse=function(P){return P.data};return O})(Backbone.Collection);J=(function(N){c(O,N);function O(){j=O.__super__.constructor.apply(this,arguments);return j}O.prototype.model=t;O.prototype.url="/rest/sitecss";O.prototype.parse=function(P){return P.data};return O})(Backbone.Collection);f=(function(O){c(N,O);function N(){i=N.__super__.constructor.apply(this,arguments);return i}N.prototype.model=d;N.prototype.url="/rest/sitejs";N.prototype.parse=function(P){return P.data};return N})(Backbone.Collection);K=(function(N){c(O,N);function O(){g=O.__super__.constructor.apply(this,arguments);return g}O.prototype.template=TrumpetApp.admin_mgr_tmpl.entry_template;O.prototype.initialize=function(){_.bindAll(this,"render");this.model.bind("change",this.render);return this.model.bind("remove",this.unrender)};O.prototype.render=function(){var P;P=this.template.render(this.model.attributes);this.$el.html(P);return this};O.prototype.unrender=function(){return $(this.el).remove()};O.prototype.events={"click .show-entry-btn":"editme"};O.prototype.editme=function(){var T,ab,X,Z,V,Y,W,Q,S,ac,R,P,aa,U=this;aa=TrumpetApp.admin_mgr_tmpl.editor_template;S=aa.render(this.model.attributes);Q=$(".listview-list");Q.html(S);R=this.model.get("type");if(R==="path"){Q.html("SHOW ME");return this}T=$("#save-content");X=this.model.get("content");W=u(R,T,X);T.hide();T.click(function(){var ad;U.model.set("content",W.getValue());ad=U.model.save();ad.done(function(){make_alert("Saved");return $("#save-content").hide()});return ad.fail(function(){return make_alert("Failed to save model")})});P=$("#new-entry-button");P.remove();V='<div class="pull-right action-button del-entry-btn" id="del-entry-button">Delete</div>';ac=$(".listview-header");ac.append(V);ab='<div id="confirm-delete"><span class="ui-icon ui-icon-alert"></span>Delete this object?</div>';$(".sidebar").append(ab);Z=$("#del-entry-button");Y=function(){var ad;ad=U.model.destroy();ad.done(function(){var af,ae;make_alert("Deleted "+name);af={trigger:true,replace:true};ae="view/"+R;main_router.navigate("dummy",af);return main_router.navigate(ae,af)});return ad.fail(function(){return make_alert("Failed to delete "+name)})};Z.click(function(){var ad;$("#editor").hide();Q=$("#confirm-delete");Q.dialog({dialogClass:"no-close",modal:true,buttons:{"delete":function(){$(this).dialog("close");return Y()},cancel:function(){$(this).dialog("close");return $("#editor").show()}}});return ad=U.model.get("name")});return this};return O})(Backbone.View);x=(function(O){c(N,O);function N(){this.appendItem=a(this.appendItem,this);M=N.__super__.constructor.apply(this,arguments);return M}N.prototype.el=$(".right-column-content");N.prototype.render=function(Q){var P;P=TrumpetApp.admin_mgr_tmpl.listview_template;this.$el.html(P.render(Q));return this};N.prototype.remove=function(){this.undelegateEvents();this.$el.empty();this.stopListening();return this};N.prototype.appendItem=function(Q){var R,P;P=new K({model:Q});R=P.render(Q).el;return $(".listview-list").append(R)};N.prototype.events={"click .add-entry-btn":"new_entry_view"};N.prototype.new_entry_view=function(){var S,T,R,W,Q,V,P,U=this;W=this.collection.model;Q=new W();P=TrumpetApp.admin_mgr_tmpl.create_template;R=P.render(Q.attributes);$(".listview-list").html(R);V=Q.get("type");S=$("#create-content");T=u(V,S,"");S.hide();S.click(function(){var Y,X;Q.set("content",T.getValue());Y=$("#nameinput").val();Q.set("name",Y);U.collection.add(Q);X=Q.save();X.done(function(){var Z;Z="Created "+Y;return make_alert(Z)});return X.fail(function(){var Z;Z="Failed to create "+Y;return make_alert(Z)})});return this};return N})(Backbone.View);e=(function(O){c(N,O);function N(){L=N.__super__.constructor.apply(this,arguments);return L}N.prototype.initialize=function(){console.log("Init SitePathListView");this.collection=new E;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return N})(x);C=(function(O){c(N,O);function N(){I=N.__super__.constructor.apply(this,arguments);return I}N.prototype.initialize=function(){console.log("Init SiteTemplateListView");this.collection=new r;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return N})(x);B=(function(O){c(N,O);function N(){H=N.__super__.constructor.apply(this,arguments);return H}N.prototype.initialize=function(){console.log("Init SiteCSSListView");this.collection=new J;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return N})(x);h=(function(O){c(N,O);function N(){G=N.__super__.constructor.apply(this,arguments);return G}N.prototype.initialize=function(){console.log("Init SiteJSListView");this.collection=new f;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return N})(x);A=(function(O){var P;c(N,O);function N(){F=N.__super__.constructor.apply(this,arguments);return F}N.prototype.el=$(".sidebar");N.prototype.initialize=function(){console.log("Init SideView");return this.current_view=null};N.prototype.template=TrumpetApp.admin_mgr_tmpl.side_view_template;N.prototype.render=function(){$(this.el).html(this.template.render());return this};P={trigger:true,replace:true};N.prototype.events={"click .home-button":function(){return main_router.navigate("",P)},"click .sitepaths-button":function(){$(".listview-list").remove();main_router.navigate("dummy",P);return main_router.navigate("view/path",P)},"click .sitetmpl-button":function(){$(".listview-list").remove();main_router.navigate("dummy",P);return main_router.navigate("view/tmpl",P)},"click .sitecss-button":function(){$(".listview-list").remove();main_router.navigate("dummy",P);return main_router.navigate("view/css",P)},"click .sitejs-button":function(){$(".listview-list").remove();main_router.navigate("dummy",P);return main_router.navigate("view/js",P)}};return N})(Backbone.View);window.main_router=new s;window.side_view=new A;return Backbone.history.start()})}).call(this);