// Generated by CoffeeScript 1.6.3
(function() {
  $(document).ready(function() {
    var check_for_mainloop_one, check_for_mainloop_two, check_timeout, handle_teacup_field, layout, layout_content_retrieved, url, webview_id;
    url = document.URL;
    webview_id = url.replace(/^.*\/|\.[^.]*$/g, '');
    url = '/rest/webviews/' + webview_id;
    layout = {};
    handle_teacup_field = function(fieldname) {
      var field, html, template;
      field = TrumpetApp.LayoutModel.model.fields[fieldname];
      CoffeeScript.run(field.content);
      template = TrumpetApp.CurrentLayoutTemplate;
      html = template(field);
      TrumpetApp.CurrentLayoutTemplate = null;
      return html;
    };
    TrumpetApp.handle_teacup_field = handle_teacup_field;
    TrumpetApp.CurrentLayoutTemplate = null;
    check_timeout = 300;
    check_for_mainloop_one = function() {
      if (TrumpetApp.main_loop === null) {
        return window.setTimeout(check_for_mainloop_two, check_timeout);
      } else {
        return TrumpetApp.main_loop();
      }
    };
    check_for_mainloop_two = function() {
      if (TrumpetApp.main_loop === null) {
        return window.setTimeout(check_for_mainloop_one, check_timeout);
      } else {
        return TrumpetApp.main_loop();
      }
    };
    layout_content_retrieved = function(data, status, xhr) {
      var html, template;
      if (status === 'success') {
        layout = data;
        TrumpetApp.LayoutModel = layout;
        window.WVlayout = layout;
        CoffeeScript.run(layout.template.content);
        template = TrumpetApp.LayoutTemplate;
        html = template(layout.model);
        $('body').html(html);
        return window.setTimeout(check_for_mainloop_one, check_timeout);
      }
    };
    return $.get(url, {}, layout_content_retrieved);
  });

}).call(this);
