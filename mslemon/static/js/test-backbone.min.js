(function(){var b={}.hasOwnProperty,c=function(g,e){for(var d in e){if(b.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f();g.__super__=e.prototype;return g},a=function(d,e){return function(){return d.apply(e,arguments)}};jQuery(function(){var p,u,v,s,d,o,t,q,n,j,m,k,r,l,i,h,g,f,e;j=TrumpetApp.get_template;r=j("show-site-template-ejs");window.show_template=r;t=j("edit-site-template-ejs");window.edit_template=t;k=j("list-sitetext-entries");window.list_template=k;n=function(x,w){return make_alert("Succesful Transfer","success")};q=function(x,w){return make_alert("Error in Transfer","error")};u=(function(x){c(w,x);function w(){l=w.__super__.constructor.apply(this,arguments);return l}w.prototype.routes={"":"home","/edit/{id}":"edit"};return w})(Backbone.Router);v=(function(x){c(w,x);function w(){i=w.__super__.constructor.apply(this,arguments);return i}w.prototype.defaults={type:"tutwiki",name:"",content:""};return w})(Backbone.Model);s=(function(x){c(w,x);function w(){h=w.__super__.constructor.apply(this,arguments);return h}w.prototype.model=v;w.prototype.url="/rest/sitetext";w.prototype.parse=function(y){return y.data};return w})(Backbone.Collection);p=(function(x){c(w,x);function w(){this.unrender=a(this.unrender,this);this.render=a(this.render,this);g=w.__super__.constructor.apply(this,arguments);return g}w.prototype.el=$(".ace-editor");w.prototype.initialize=function(){this.model.bind("change",this.render);return this.model.bind("remove",this.unrender)};w.prototype.render=function(){var A,z,y;$(".something").hide();y=this.model.get("name");z=t.render({name:y});$(this.el).html(z);this.editor=ace.edit("editor");this.editor.getSession().setMode("ace/mode/markdown");this.editor.setTheme("ace/theme/cobalt");A=this.model.get("content");this.editor.setValue(A);window.editor=this.editor;return this};w.prototype.unrender=function(){return $(this.el).remove()};w.prototype.remove=function(){return this.model.destroy()};w.prototype.save=function(){var y;y=this.editor.getValue();this.model.set("name",$("input").val());this.model.set("content",y);this.model.save();this.unrender();$("#site-text-editor").remove();return $(".something").show()};w.prototype.events={"click .save":"save"};return w})(Backbone.View);o=(function(w){c(x,w);function x(){this.unrender=a(this.unrender,this);this.renderForm=a(this.renderForm,this);this.render=a(this.render,this);f=x.__super__.constructor.apply(this,arguments);return f}x.prototype.tagName="div";x.prototype.className="sitetext-entry";x.prototype.initialize=function(){this.model.bind("change",this.render);this.model.bind("remove",this.unrender);return $(this.el).addClass("listview-list-entry")};x.prototype.render=function(){var z,y;y=this.model.get("name");z=r.render({name:y});$(this.el).html(z);return this};x.prototype.renderForm=function(){this.editor=new p({model:this.model});this.editor.render();return this};x.prototype.unrender=function(){return $(this.el).remove()};x.prototype.remove=function(){return this.model.destroy()};x.prototype.edit=function(){return this.renderForm()};x.prototype.save=function(){var y;y=$("textarea").val();this.model.set("name",$("input").val());this.model.set("content",y);return this.model.save()};x.prototype.events={"click .delete":"remove","click .edit":"edit","click .save":"save"};return x})(Backbone.View);d=(function(x){c(w,x);function w(){e=w.__super__.constructor.apply(this,arguments);return e}w.prototype.el=$(".site-text-list");w.prototype.initialize=function(){console.log("Init SiteTextListView");this.counter=0;this.collection=new s;return this.collection.bind("add",this.appendItem)};w.prototype.render=function(){var y;y=k.render();$(this.el).html(y);return this};w.prototype.addItem=function(){var y;this.counter++;y=new v;return this.collection.add(y)};w.prototype.appendItem=function(z){var y;y=new o({model:z});return $(".site-text-list").append(y.render().el)};w.prototype.fetchItems=function(){return this.collection.fetch({success:n})};w.prototype.events={"click .new-site-text-button":"addItem","click .fetch-site-text-button":"fetchItems"};return w})(Backbone.View);window.list_view=new d;window.router=new u;m=function(){console.log("Home Route");return window.list_view.render()};window.router.on("route:home",m);return Backbone.history.start()})}).call(this);