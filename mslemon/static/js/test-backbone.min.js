(function(){var b={}.hasOwnProperty,c=function(g,e){for(var d in e){if(b.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f();g.__super__=e.prototype;return g},a=function(d,e){return function(){return d.apply(e,arguments)}};jQuery(function(){var o,t,u,r,d,n,s,p,m,l,j,q,k,i,h,g,f,e;q=get_template("show-site-template-ejs");window.show_template=q;s=get_template("edit-site-template-ejs");window.edit_template=s;j=get_template("list-sitetext-entries");window.list_template=j;m=function(w,v){return make_alert("Succesful Transfer","success")};p=function(w,v){return make_alert("Error in Transfer","error")};t=(function(w){c(v,w);function v(){k=v.__super__.constructor.apply(this,arguments);return k}v.prototype.routes={"":"home","/edit/{id}":"edit"};return v})(Backbone.Router);u=(function(w){c(v,w);function v(){i=v.__super__.constructor.apply(this,arguments);return i}v.prototype.defaults={type:"tutwiki",name:"",content:""};return v})(Backbone.Model);r=(function(w){c(v,w);function v(){h=v.__super__.constructor.apply(this,arguments);return h}v.prototype.model=u;v.prototype.url="/rest/sitetext";v.prototype.parse=function(x){return x.data};return v})(Backbone.Collection);o=(function(w){c(v,w);function v(){this.unrender=a(this.unrender,this);this.render=a(this.render,this);g=v.__super__.constructor.apply(this,arguments);return g}v.prototype.el=$(".ace-editor");v.prototype.initialize=function(){this.model.bind("change",this.render);return this.model.bind("remove",this.unrender)};v.prototype.render=function(){var z,y,x;$(".something").hide();x=this.model.get("name");y=s.render({name:x});$(this.el).html(y);this.editor=ace.edit("editor");this.editor.getSession().setMode("ace/mode/markdown");this.editor.setTheme("ace/theme/cobalt");z=this.model.get("content");this.editor.setValue(z);window.editor=this.editor;return this};v.prototype.unrender=function(){return $(this.el).remove()};v.prototype.remove=function(){return this.model.destroy()};v.prototype.save=function(){var x;x=this.editor.getValue();this.model.set("name",$("input").val());this.model.set("content",x);this.model.save();this.unrender();$("#site-text-editor").remove();return $(".something").show()};v.prototype.events={"click .save":"save"};return v})(Backbone.View);n=(function(v){c(w,v);function w(){this.unrender=a(this.unrender,this);this.renderForm=a(this.renderForm,this);this.render=a(this.render,this);f=w.__super__.constructor.apply(this,arguments);return f}w.prototype.tagName="div";w.prototype.className="sitetext-entry";w.prototype.initialize=function(){this.model.bind("change",this.render);this.model.bind("remove",this.unrender);return $(this.el).addClass("listview-list-entry")};w.prototype.render=function(){var y,x;x=this.model.get("name");y=q.render({name:x});$(this.el).html(y);return this};w.prototype.renderForm=function(){this.editor=new o({model:this.model});this.editor.render();return this};w.prototype.unrender=function(){return $(this.el).remove()};w.prototype.remove=function(){return this.model.destroy()};w.prototype.edit=function(){return this.renderForm()};w.prototype.save=function(){var x;x=$("textarea").val();this.model.set("name",$("input").val());this.model.set("content",x);return this.model.save()};w.prototype.events={"click .delete":"remove","click .edit":"edit","click .save":"save"};return w})(Backbone.View);d=(function(w){c(v,w);function v(){e=v.__super__.constructor.apply(this,arguments);return e}v.prototype.el=$(".site-text-list");v.prototype.initialize=function(){console.log("Init SiteTextListView");this.counter=0;this.collection=new r;return this.collection.bind("add",this.appendItem)};v.prototype.render=function(){var x;x=j.render();$(this.el).html(x);return this};v.prototype.addItem=function(){var x;this.counter++;x=new u;return this.collection.add(x)};v.prototype.appendItem=function(y){var x;x=new n({model:y});return $(".site-text-list").append(x.render().el)};v.prototype.fetchItems=function(){return this.collection.fetch({success:m})};v.prototype.events={"click .new-site-text-button":"addItem","click .fetch-site-text-button":"fetchItems"};return v})(Backbone.View);window.list_view=new d;window.router=new t;l=function(){console.log("Home Route");return window.list_view.render()};window.router.on("route:home",l);return Backbone.history.start()})}).call(this);