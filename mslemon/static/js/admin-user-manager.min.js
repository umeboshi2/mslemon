(function(){var b={}.hasOwnProperty,c=function(g,e){for(var d in e){if(b.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f();g.__super__=e.prototype;return g},a=function(d,e){return function(){return d.apply(e,arguments)}};jQuery(function(){var j,A,x,N,f,y,u,B,d,s,t,D,v,H,w,e,r,z,h,C,F,E,G,q,P,O,M,L,K,J,I,p,o,n,m,l,k,i,g;z=function(){return{user:r,group:u}};C=function(){var R,S,T,Q;console.log("make_group_select_dlg");S='<div id="select-group-dialog"></div>';T=$(".main-content");T.append(S);R=$("#select-group-dialog");Q=new B;S=Q.render;return R.dialog({dialogClass:"no-close",modal:true,buttons:{cancel:function(){$(this).dialog("close");return R.remove()}}})};t=(function(R){c(Q,R);function Q(){G=Q.__super__.constructor.apply(this,arguments);return G}Q.prototype.routes={"":"home","view/:listview":"listview"};Q.prototype.common=function(){var S;S=E;S.render();if(S.current_view!==null){return S.current_view.remove()}};Q.prototype.home=function(){return this.common()};Q.prototype.listview=function(T){var S,U;this.common();console.log("lview is "+T);S=z()[T];window.klass=S;U=new S;U.render({type:T});return E.current_view=U};return Q})(Backbone.Router);v=(function(Q){c(R,Q);function R(){q=R.__super__.constructor.apply(this,arguments);return q}R.prototype.type=Backbone.HasMany;R.prototype.relatedModel="Group";R.prototype.collectionType="UserList";R.prototype.defaults={objtype:"user"};return R})(Supermodel.Model);f=(function(R){c(Q,R);function Q(){p=Q.__super__.constructor.apply(this,arguments);return p}Q.prototype.defaults={objtype:"group"};return Q})(Backbone.RelationalModel);j=(function(R){c(Q,R);function Q(){o=Q.__super__.constructor.apply(this,arguments);return o}Q.prototype.parse=function(S){return S.data};return Q})(Backbone.Collection);e=(function(R){c(Q,R);function Q(){n=Q.__super__.constructor.apply(this,arguments);return n}Q.prototype.model=v;Q.prototype.url="/rest/users";return Q})(j);y=(function(R){c(Q,R);function Q(){m=Q.__super__.constructor.apply(this,arguments);return m}Q.prototype.model=f;Q.prototype.url="/rest/groups";return Q})(j);F=function(Q){var R,S;R=(function(U){c(T,U);function T(){S=T.__super__.constructor.apply(this,arguments);return S}T.prototype.model=f;T.prototype.url="/rest/users/"+Q+"/groups";return T})(j);return new R};N=(function(Q){c(R,Q);function R(){l=R.__super__.constructor.apply(this,arguments);return l}R.prototype.template=TrumpetApp.admin_usrmgr_tmpl.entry;R.prototype.initialize=function(){_.bindAll(this,"render");this.model.bind("change",this.render);return this.model.bind("remove",this.unrender)};R.prototype.render=function(){var U,S,T;T=TrumpetApp.admin_usrmgr_tmpl;if(this.model.has("username")){S=T.user_entry}else{S=T.entry}U=S(this.model.attributes);this.$el.html(U);return this};R.prototype.unrender=function(){return $(this.el).remove()};R.prototype.events={"click .show-entry-btn":"showentry"};R.prototype.showentry=function(){var U,T,S;U=$(".listview-list");if(this.model.get("objtype")==="user"){S=new s({main_model:this.model})}else{S=new d({main_model:this.model})}T=S.render(this.model.attributes);return U.html(T)};return R})(Backbone.View);x=(function(R){c(Q,R);function Q(){k=Q.__super__.constructor.apply(this,arguments);return k}Q.prototype.el=$(".right-column-content");Q.prototype.remove=function(){this.undelegateEvents();this.$el.empty();this.stopListening();return this};return Q})(Backbone.View);s=(function(Q){c(R,Q);function R(){i=R.__super__.constructor.apply(this,arguments);return i}R.prototype.render=function(T){var U,S,V;S=TrumpetApp.admin_usrmgr_tmpl.main_user_view;U=S(T);this.$el.html(U);V=new H(T);return this};return R})(x);d=(function(R){c(Q,R);function Q(){g=Q.__super__.constructor.apply(this,arguments);return g}Q.prototype.render=function(T){var S;S=TrumpetApp.admin_usrmgr_tmpl.main_group_view;this.$el.html(S(T));return this};return Q})(x);A=(function(R){c(Q,R);function Q(){this.appendItem=a(this.appendItem,this);P=Q.__super__.constructor.apply(this,arguments);return P}Q.prototype.render=function(T){var S;S=TrumpetApp.admin_usrmgr_tmpl.listview;this.$el.html(S(T));return this};Q.prototype.modelView=N;Q.prototype.appendItem=function(T){var U,S;S=new this.modelView({model:T});U=S.render(T).el;return $(".listview-list").append(U)};Q.prototype.events={"click .add-entry-btn":"new_entry_view"};Q.prototype.new_entry_view=function(){var U,V,T,S;V=this.collection.model;T=new V();S=TrumpetApp.admin_usrmgr_tmpl.create;U=S(T.attributes);return $(".listview-list").html(U)};return Q})(x);r=(function(R){c(Q,R);function Q(){this.appendItem=a(this.appendItem,this);O=Q.__super__.constructor.apply(this,arguments);return O}Q.prototype.initialize=function(){console.log("Init UserListView");this.collection=new e;this.collection.bind("add",this.appendItem);return this.collection.fetch()};Q.prototype.appendItem=function(T){var U,S;S=new this.modelView({model:T});window.mbview=S;U=S.render(T).el;return $(".listview-list").append(U)};return Q})(A);u=(function(R){c(Q,R);function Q(){M=Q.__super__.constructor.apply(this,arguments);return M}Q.prototype.initialize=function(){console.log("Init GroupListView");this.collection=new y;this.collection.bind("add",this.appendItem);return this.collection.fetch()};return Q})(A);B=(function(Q){c(R,Q);function R(){this.appendItem=a(this.appendItem,this);L=R.__super__.constructor.apply(this,arguments);return L}R.prototype.el=$("#select-group-dialog");R.prototype.initialize=function(){console.log("Init GroupSelectView");this.collection=new y;this.collection.bind("add",this.appendItem);return this.collection.fetch()};R.prototype.remove=function(){this.undelegateEvents();this.$el.empty();this.stopListening();return this};R.prototype.render=function(T){var S;S=TrumpetApp.admin_usrmgr_tmpl.listview;this.$el.html(S.render(T));return this};R.prototype.modelView=N;R.prototype.appendItem=function(T){var U,S;S=new this.modelView({model:T});U=S.render(T).el;return $("#select-group-dialog").append(U)};return R})(Backbone.View);w=(function(Q){c(R,Q);function R(){K=R.__super__.constructor.apply(this,arguments);return K}R.prototype.template=TrumpetApp.admin_usrmgr_tmpl.entry;R.prototype.initialize=function(){_.bindAll(this,"render");this.model.bind("change",this.render);return this.model.bind("remove",this.unrender)};R.prototype.render=function(){var V,U,S,T,W=this;T=TrumpetApp.admin_usrmgr_tmpl;S=T.user_group_entry;U=S(this.model.attributes);this.$el.html(U);V=$("#addgroup");V.click(function(){return W.add_group()});return this};R.prototype.unrender=function(){return $(this.el).remove()};R.prototype.events={"click .detach-group":"detach_group"};R.prototype.detach_group=function(){this.model.destroy();return this.unrender()};R.prototype.add_group=function(){console.log("add_group");return C()};return R})(Backbone.View);H=(function(Q){c(R,Q);function R(){this.appendItem=a(this.appendItem,this);J=R.__super__.constructor.apply(this,arguments);return J}R.prototype.el=$(".user-group-list");R.prototype.initialize=function(S){this.collection=F(S.id);this.collection.bind("add",this.appendItem);return this.collection.fetch()};R.prototype.modelView=w;R.prototype.appendItem=function(T){var U,S;S=new this.modelView({model:T});U=S.render(T).el;return $(".user-group-list").append(U)};R.prototype.events={"click #addgroup":"add_group"};R.prototype.add_group=function(){return console.log("add_group")};return R})(Backbone.View);D=(function(R){var S;c(Q,R);function Q(){I=Q.__super__.constructor.apply(this,arguments);return I}Q.prototype.el=$(".sidebar");Q.prototype.initialize=function(){return this.current_view=null};Q.prototype.render=function(){var U,T;T=TrumpetApp.admin_usrmgr_tmpl.side_view;U=T();$(this.el).html(U);return this};S={trigger:true,replace:true};Q.prototype.events={"click .home-button":function(){return h.navigate("",S)},"click .users-button":function(){$(".listview-list").remove();h.navigate("dummy",S);return h.navigate("view/user",S)},"click .groups-button":function(){$(".listview-list").remove();h.navigate("dummy",S);return h.navigate("view/group",S)}};return Q})(Backbone.View);h=new t;E=new D;return Backbone.history.start()})}).call(this);