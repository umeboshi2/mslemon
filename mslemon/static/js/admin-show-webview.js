// Generated by CoffeeScript 1.6.3
(function() {
  $(document).ready(function() {
    var create_editor, div, editing_space, editor_template, field_list, header_template, icon, input, label, model_field_url, renderable, span, strong, text, webview_id;
    renderable = teacup.renderable;
    div = teacup.div;
    icon = teacup.i;
    strong = teacup.strong;
    span = teacup.span;
    label = teacup.label;
    input = teacup.input;
    text = teacup.text;
    editing_space = $('.editing-space');
    field_list = $('.field-list');
    webview_id = $('input[name=webview_id]').val();
    model_field_url = function(model_id, field_id) {
      var url;
      url = '/rest/admin/layoutmodels/' + model_id;
      url = url + '/fields/' + field_id;
      return url;
    };
    header_template = renderable(function(content) {
      return div('.btn.btn-default.btn-xs', function() {
        return text(content);
      });
    });
    editor_template = renderable(function() {
      div('#edit-status.listview-header', function() {
        text('Editing template');
        div('#save-content.action-button', function() {
          return text('Save');
        });
        return div('#cancel-button.action-button.pull-right', function() {
          return text('Cancel');
        });
      });
      return div('#editor');
    });
    create_editor = function(webview_id) {
      var cancel_button, content_callback, editor, fresh_edit, html, response, save_button, save_edit_error, session, url;
      html = editor_template;
      editing_space.html(html);
      editing_space.show();
      save_button = $('#save-content');
      save_button.hide();
      cancel_button = $('#cancel-button');
      cancel_button.click(function() {
        return window.location.reload();
      });
      editor = ace.edit('editor');
      TrumpetApp.editor = editor;
      session = editor.getSession();
      session.on('change', function() {
        return save_button.show();
      });
      session.setMode('ace/mode/coffee');
      session.setTabSize(4);
      editor.setTheme('ace/theme/trumpet');
      url = '/rest/admin/webviews/' + webview_id;
      content_callback = function(data, status, xhr) {
        if (status === 'success') {
          window.rdata = data;
          if (data.template !== null) {
            editor.setValue(data.template);
            return save_button.hide();
          }
        }
      };
      response = $.get(url, {}, content_callback);
      fresh_edit = function(data, status, xhr) {
        if (status === 'success') {
          save_button.hide();
        }
        TrumpetApp.rdata = data;
        TrumpetApp.rstatus = status;
        return TrumpetApp.rxhr = xhr;
      };
      save_edit_error = function(data, status, xhr) {
        TrumpetApp.rdata = data;
        TrumpetApp.rstatus = status;
        TrumpetApp.rxhr = xhr;
        return TrumpetApp.make_alert("Error in save");
      };
      return save_button.click(function() {
        var formdata;
        formdata = {
          update: 'submit',
          template: editor.getValue()
        };
        url = '/rest/admin/webviews/' + webview_id;
        return $.ajax(url, {
          type: 'PUT',
          data: formdata,
          success: fresh_edit,
          error: save_edit_error,
          dataType: 'json'
        });
      });
    };
    return create_editor(webview_id);
  });

}).call(this);
